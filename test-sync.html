<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ê¸°í™” ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }
        button {
            padding: 10px 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .status {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
            margin: 10px 0;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
        .data-display {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border-left: 3px solid #667eea;
        }
        .success {
            color: #4caf50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .info {
            color: #2196f3;
        }
        input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
        select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ConceptArtManager í…ŒìŠ¤íŠ¸ íŒ¨ë„ -->
        <div class="panel">
            <h2>ğŸ“¦ ConceptArtManager (ë°ì´í„° ì¶”ê°€)</h2>

            <div class="controls">
                <h3>ìºë¦­í„° ì¶”ê°€</h3>
                <input type="text" id="charName" placeholder="ìºë¦­í„° ì´ë¦„">
                <input type="text" id="charDesc" placeholder="ìºë¦­í„° ì„¤ëª…">
                <button onclick="addCharacter()">ìºë¦­í„° ì¶”ê°€</button>

                <h3>ì¥ì†Œ ì¶”ê°€</h3>
                <input type="text" id="locName" placeholder="ì¥ì†Œ ì´ë¦„">
                <input type="text" id="locDesc" placeholder="ì¥ì†Œ ì„¤ëª…">
                <button onclick="addLocation()">ì¥ì†Œ ì¶”ê°€</button>

                <h3>ì†Œí’ˆ ì¶”ê°€</h3>
                <input type="text" id="propName" placeholder="ì†Œí’ˆ ì´ë¦„">
                <input type="text" id="propDesc" placeholder="ì†Œí’ˆ ì„¤ëª…">
                <button onclick="addProp()">ì†Œí’ˆ ì¶”ê°€</button>
            </div>

            <button onclick="refreshManagerData()">ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
            <button onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>

            <h3>í˜„ì¬ ë°ì´í„°</h3>
            <div id="managerData" class="data-display"></div>

            <h3>ìƒíƒœ ë¡œê·¸</h3>
            <div id="managerStatus" class="status"></div>
        </div>

        <!-- ShotDetailDataSync í…ŒìŠ¤íŠ¸ íŒ¨ë„ -->
        <div class="panel">
            <h2>ğŸ”„ ShotDetailDataSync (ë™ê¸°í™” í™•ì¸)</h2>

            <div class="controls">
                <h3>ìºë¦­í„° ì…€ë ‰í„°</h3>
                <select id="characterSelector">
                    <option value="">ìºë¦­í„° ì„ íƒ</option>
                </select>

                <h3>ì¥ì†Œ ì…€ë ‰í„°</h3>
                <select id="locationSelector">
                    <option value="">ì¥ì†Œ ì„ íƒ</option>
                </select>

                <h3>ì†Œí’ˆ ì…€ë ‰í„°</h3>
                <select id="propsSelector">
                    <option value="">ì†Œí’ˆ ì„ íƒ</option>
                </select>
            </div>

            <button onclick="requestSync()">ë™ê¸°í™” ìš”ì²­</button>
            <button onclick="checkSelectors()">ì…€ë ‰í„° ìƒíƒœ í™•ì¸</button>

            <h3>ë™ê¸°í™”ëœ ë°ì´í„°</h3>
            <div id="syncData" class="data-display"></div>

            <h3>ìƒíƒœ ë¡œê·¸</h3>
            <div id="syncStatus" class="status"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/concept-art-manager.js"></script>
    <script src="js/shot-detail-sync.js"></script>
    <script>
        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function log(target, message, type = 'info') {
            const statusEl = document.getElementById(target);
            const time = new Date().toLocaleTimeString();
            const msgEl = document.createElement('div');
            msgEl.className = type;
            msgEl.innerHTML = `[${time}] ${message}`;
            statusEl.appendChild(msgEl);
            statusEl.scrollTop = statusEl.scrollHeight;
        }

        // ConceptArtManager í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function addCharacter() {
            const name = document.getElementById('charName').value;
            const description = document.getElementById('charDesc').value;

            if (!name) {
                log('managerStatus', 'ìºë¦­í„° ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            const char = window.conceptArtManager.addCharacter({
                name: name,
                description: description
            });

            log('managerStatus', `ìºë¦­í„° ì¶”ê°€ë¨: ${char.name} (ID: ${char.id})`, 'success');
            document.getElementById('charName').value = '';
            document.getElementById('charDesc').value = '';
            refreshManagerData();
        }

        function addLocation() {
            const name = document.getElementById('locName').value;
            const description = document.getElementById('locDesc').value;

            if (!name) {
                log('managerStatus', 'ì¥ì†Œ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            const loc = window.conceptArtManager.addLocation({
                name: name,
                description: description
            });

            log('managerStatus', `ì¥ì†Œ ì¶”ê°€ë¨: ${loc.name} (ID: ${loc.id})`, 'success');
            document.getElementById('locName').value = '';
            document.getElementById('locDesc').value = '';
            refreshManagerData();
        }

        function addProp() {
            const name = document.getElementById('propName').value;
            const description = document.getElementById('propDesc').value;

            if (!name) {
                log('managerStatus', 'ì†Œí’ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            const prop = window.conceptArtManager.addProp({
                name: name,
                description: description
            });

            log('managerStatus', `ì†Œí’ˆ ì¶”ê°€ë¨: ${prop.name} (ID: ${prop.id})`, 'success');
            document.getElementById('propName').value = '';
            document.getElementById('propDesc').value = '';
            refreshManagerData();
        }

        function refreshManagerData() {
            const data = window.conceptArtManager.getData();
            const display = document.getElementById('managerData');

            if (!data) {
                display.innerHTML = '<div class="item">ë°ì´í„° ì—†ìŒ</div>';
                return;
            }

            let html = '';

            // ìºë¦­í„°
            html += `<strong>ìºë¦­í„° (${data.characters?.length || 0})</strong>`;
            if (data.characters?.length) {
                data.characters.forEach(c => {
                    html += `<div class="item">ğŸ“¦ ${c.name} (${c.source})</div>`;
                });
            }

            // ì¥ì†Œ
            html += `<strong>ì¥ì†Œ (${data.locations?.length || 0})</strong>`;
            if (data.locations?.length) {
                data.locations.forEach(l => {
                    html += `<div class="item">ğŸ›ï¸ ${l.name} (${l.source})</div>`;
                });
            }

            // ì†Œí’ˆ
            html += `<strong>ì†Œí’ˆ (${data.props?.length || 0})</strong>`;
            if (data.props?.length) {
                data.props.forEach(p => {
                    html += `<div class="item">ğŸ­ ${p.name} (${p.source})</div>`;
                });
            }

            display.innerHTML = html;
            log('managerStatus', 'ë°ì´í„° ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ', 'success');
        }

        function clearAllData() {
            if (confirm('ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                window.conceptArtManager.clearAllData();
                log('managerStatus', 'ëª¨ë“  ë°ì´í„° ì‚­ì œë¨', 'success');
                refreshManagerData();
                checkSelectors();
            }
        }

        // ShotDetailDataSync í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function requestSync() {
            window.shotDetailSync.requestSync();
            log('syncStatus', 'ë™ê¸°í™” ìš”ì²­ ì „ì†¡ë¨', 'info');
            setTimeout(checkSelectors, 100);
        }

        function checkSelectors() {
            const charSel = document.getElementById('characterSelector');
            const locSel = document.getElementById('locationSelector');
            const propSel = document.getElementById('propsSelector');

            log('syncStatus', `ìºë¦­í„° ì˜µì…˜: ${charSel.options.length - 1}ê°œ`, 'info');
            log('syncStatus', `ì¥ì†Œ ì˜µì…˜: ${locSel.options.length - 1}ê°œ`, 'info');
            log('syncStatus', `ì†Œí’ˆ ì˜µì…˜: ${propSel.options.length - 1}ê°œ`, 'info');

            // ë™ê¸°í™”ëœ ë°ì´í„° í‘œì‹œ
            const syncData = document.getElementById('syncData');
            let html = '';

            html += '<strong>ìºë¦­í„° ì…€ë ‰í„°</strong>';
            for (let i = 1; i < charSel.options.length; i++) {
                html += `<div class="item">ğŸ‘¤ ${charSel.options[i].text}</div>`;
            }

            html += '<strong>ì¥ì†Œ ì…€ë ‰í„°</strong>';
            for (let i = 1; i < locSel.options.length; i++) {
                html += `<div class="item">ğŸ“ ${locSel.options[i].text}</div>`;
            }

            html += '<strong>ì†Œí’ˆ ì…€ë ‰í„°</strong>';
            for (let i = 1; i < propSel.options.length; i++) {
                html += `<div class="item">ğŸ“¦ ${propSel.options[i].text}</div>`;
            }

            syncData.innerHTML = html || '<div class="item">ë™ê¸°í™”ëœ ë°ì´í„° ì—†ìŒ</div>';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('DOMContentLoaded', () => {
            log('managerStatus', 'ConceptArtManager ì´ˆê¸°í™”ë¨', 'success');
            log('syncStatus', 'ShotDetailDataSync ì´ˆê¸°í™”ë¨', 'success');

            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            refreshManagerData();
            setTimeout(checkSelectors, 500);

            // BroadcastChannel ìƒíƒœ í™•ì¸
            if (window.BroadcastChannel) {
                log('syncStatus', 'BroadcastChannel ì§€ì›ë¨ âœ…', 'success');
            } else {
                log('syncStatus', 'BroadcastChannel ë¯¸ì§€ì› - Storage ì´ë²¤íŠ¸ ì‚¬ìš©', 'info');
            }
        });
    </script>
</body>
</html>