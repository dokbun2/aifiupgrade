<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>컨셉아트 Persistence 테스트</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        .test-section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .danger { background: #f44336; }
        .danger:hover { background: #da190b; }
        pre { background: #000; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>🎨 컨셉아트 Persistence 테스트</h1>
    
    <div class="test-section">
        <h2>1. 테스트 데이터 저장</h2>
        <button onclick="saveTestData()">테스트 데이터 저장</button>
        <button onclick="checkStorage()">저장소 확인</button>
        <button onclick="location.reload()">새로고침 테스트</button>
        <pre id="save-result"></pre>
    </div>

    <div class="test-section">
        <h2>2. 저장된 데이터 확인</h2>
        <pre id="storage-status"></pre>
    </div>

    <div class="test-section">
        <h2>3. 초기화</h2>
        <button class="danger" onclick="clearAll()">모든 저장소 초기화</button>
    </div>

    <script>
        const testData = {
            characters: [
                { id: 'test_char_1', name: '테스트 캐릭터 1', description: '테스트용 캐릭터' }
            ],
            locations: [
                { id: 'test_loc_1', name: '테스트 장소 1', description: '테스트용 장소' }
            ],
            props: [
                { id: 'test_prop_1', name: '테스트 소품 1', description: '테스트용 소품' }
            ],
            currentCharacter: 'test_char_1',
            currentType: 'character',
            prompts: {
                'test_char_1': {
                    universal: '테스트 프롬프트\n줄바꿈 테스트',
                    universal_translated: 'Test prompt\nLine break test'
                }
            },
            universal: '전역 프롬프트 테스트',
            universal_translated: 'Global prompt test',
            images: {}
        };

        function saveTestData() {
            const dataStr = JSON.stringify(testData);
            
            // sessionStorage와 localStorage 모두에 저장
            sessionStorage.setItem('conceptArtData', dataStr);
            localStorage.setItem('conceptArtData', dataStr);
            
            document.getElementById('save-result').innerHTML = 
                '<span class="success">✅ 테스트 데이터 저장 완료!</span>\n' +
                '저장된 데이터 크기: ' + dataStr.length + ' bytes\n\n' +
                JSON.stringify(testData, null, 2);
            
            checkStorage();
        }

        function checkStorage() {
            const sessionData = sessionStorage.getItem('conceptArtData');
            const localData = localStorage.getItem('conceptArtData');
            
            let result = '<h3>저장소 상태:</h3>';
            
            if (sessionData) {
                const parsed = JSON.parse(sessionData);
                result += '<span class="success">✅ sessionStorage: 있음 (' + sessionData.length + ' bytes)</span>\n';
                result += '  - 캐릭터: ' + (parsed.characters?.length || 0) + '개\n';
                result += '  - 장소: ' + (parsed.locations?.length || 0) + '개\n';
                result += '  - 소품: ' + (parsed.props?.length || 0) + '개\n';
                result += '  - 프롬프트: ' + Object.keys(parsed.prompts || {}).length + '개\n';
            } else {
                result += '<span class="error">❌ sessionStorage: 없음</span>\n';
            }
            
            result += '\n';
            
            if (localData) {
                const parsed = JSON.parse(localData);
                result += '<span class="success">✅ localStorage: 있음 (' + localData.length + ' bytes)</span>\n';
                result += '  - 캐릭터: ' + (parsed.characters?.length || 0) + '개\n';
                result += '  - 장소: ' + (parsed.locations?.length || 0) + '개\n';
                result += '  - 소품: ' + (parsed.props?.length || 0) + '개\n';
                result += '  - 프롬프트: ' + Object.keys(parsed.prompts || {}).length + '개\n';
            } else {
                result += '<span class="error">❌ localStorage: 없음</span>\n';
            }
            
            document.getElementById('storage-status').innerHTML = result;
        }

        function clearAll() {
            if (confirm('모든 저장소를 초기화하시겠습니까?')) {
                sessionStorage.removeItem('conceptArtData');
                localStorage.removeItem('conceptArtData');
                document.getElementById('save-result').innerHTML = '<span class="success">✅ 초기화 완료</span>';
                checkStorage();
            }
        }

        // 페이지 로드 시 자동 확인
        window.addEventListener('load', checkStorage);
    </script>
</body>
</html>
