<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì»¨ì…‰ì•„íŠ¸ Persistence í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #1a1a1a; color: #fff; }
        .test-section { margin: 20px 0; padding: 15px; background: #2a2a2a; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .danger { background: #f44336; }
        .danger:hover { background: #da190b; }
        pre { background: #000; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .success { color: #4caf50; }
        .error { color: #f44336; }
    </style>
</head>
<body>
    <h1>ğŸ¨ ì»¨ì…‰ì•„íŠ¸ Persistence í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-section">
        <h2>1. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥</h2>
        <button onclick="saveTestData()">í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥</button>
        <button onclick="checkStorage()">ì €ì¥ì†Œ í™•ì¸</button>
        <button onclick="location.reload()">ìƒˆë¡œê³ ì¹¨ í…ŒìŠ¤íŠ¸</button>
        <pre id="save-result"></pre>
    </div>

    <div class="test-section">
        <h2>2. ì €ì¥ëœ ë°ì´í„° í™•ì¸</h2>
        <pre id="storage-status"></pre>
    </div>

    <div class="test-section">
        <h2>3. ì´ˆê¸°í™”</h2>
        <button class="danger" onclick="clearAll()">ëª¨ë“  ì €ì¥ì†Œ ì´ˆê¸°í™”</button>
    </div>

    <script>
        const testData = {
            characters: [
                { id: 'test_char_1', name: 'í…ŒìŠ¤íŠ¸ ìºë¦­í„° 1', description: 'í…ŒìŠ¤íŠ¸ìš© ìºë¦­í„°' }
            ],
            locations: [
                { id: 'test_loc_1', name: 'í…ŒìŠ¤íŠ¸ ì¥ì†Œ 1', description: 'í…ŒìŠ¤íŠ¸ìš© ì¥ì†Œ' }
            ],
            props: [
                { id: 'test_prop_1', name: 'í…ŒìŠ¤íŠ¸ ì†Œí’ˆ 1', description: 'í…ŒìŠ¤íŠ¸ìš© ì†Œí’ˆ' }
            ],
            currentCharacter: 'test_char_1',
            currentType: 'character',
            prompts: {
                'test_char_1': {
                    universal: 'í…ŒìŠ¤íŠ¸ í”„ë¡¬í”„íŠ¸\nì¤„ë°”ê¿ˆ í…ŒìŠ¤íŠ¸',
                    universal_translated: 'Test prompt\nLine break test'
                }
            },
            universal: 'ì „ì—­ í”„ë¡¬í”„íŠ¸ í…ŒìŠ¤íŠ¸',
            universal_translated: 'Global prompt test',
            images: {}
        };

        function saveTestData() {
            const dataStr = JSON.stringify(testData);
            
            // sessionStorageì™€ localStorage ëª¨ë‘ì— ì €ì¥
            sessionStorage.setItem('conceptArtData', dataStr);
            localStorage.setItem('conceptArtData', dataStr);
            
            document.getElementById('save-result').innerHTML = 
                '<span class="success">âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥ ì™„ë£Œ!</span>\n' +
                'ì €ì¥ëœ ë°ì´í„° í¬ê¸°: ' + dataStr.length + ' bytes\n\n' +
                JSON.stringify(testData, null, 2);
            
            checkStorage();
        }

        function checkStorage() {
            const sessionData = sessionStorage.getItem('conceptArtData');
            const localData = localStorage.getItem('conceptArtData');
            
            let result = '<h3>ì €ì¥ì†Œ ìƒíƒœ:</h3>';
            
            if (sessionData) {
                const parsed = JSON.parse(sessionData);
                result += '<span class="success">âœ… sessionStorage: ìˆìŒ (' + sessionData.length + ' bytes)</span>\n';
                result += '  - ìºë¦­í„°: ' + (parsed.characters?.length || 0) + 'ê°œ\n';
                result += '  - ì¥ì†Œ: ' + (parsed.locations?.length || 0) + 'ê°œ\n';
                result += '  - ì†Œí’ˆ: ' + (parsed.props?.length || 0) + 'ê°œ\n';
                result += '  - í”„ë¡¬í”„íŠ¸: ' + Object.keys(parsed.prompts || {}).length + 'ê°œ\n';
            } else {
                result += '<span class="error">âŒ sessionStorage: ì—†ìŒ</span>\n';
            }
            
            result += '\n';
            
            if (localData) {
                const parsed = JSON.parse(localData);
                result += '<span class="success">âœ… localStorage: ìˆìŒ (' + localData.length + ' bytes)</span>\n';
                result += '  - ìºë¦­í„°: ' + (parsed.characters?.length || 0) + 'ê°œ\n';
                result += '  - ì¥ì†Œ: ' + (parsed.locations?.length || 0) + 'ê°œ\n';
                result += '  - ì†Œí’ˆ: ' + (parsed.props?.length || 0) + 'ê°œ\n';
                result += '  - í”„ë¡¬í”„íŠ¸: ' + Object.keys(parsed.prompts || {}).length + 'ê°œ\n';
            } else {
                result += '<span class="error">âŒ localStorage: ì—†ìŒ</span>\n';
            }
            
            document.getElementById('storage-status').innerHTML = result;
        }

        function clearAll() {
            if (confirm('ëª¨ë“  ì €ì¥ì†Œë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                sessionStorage.removeItem('conceptArtData');
                localStorage.removeItem('conceptArtData');
                document.getElementById('save-result').innerHTML = '<span class="success">âœ… ì´ˆê¸°í™” ì™„ë£Œ</span>';
                checkStorage();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('load', checkStorage);
    </script>
</body>
</html>
